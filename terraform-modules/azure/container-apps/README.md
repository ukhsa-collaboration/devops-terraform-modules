<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.5 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | >= 3.91, < 4.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | >= 3.91, < 4.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_resource_name_prefix"></a> [resource\_name\_prefix](#module\_resource\_name\_prefix) | git@github.com:UKHSA-Internal/devops-terraform-modules.git//terraform-modules/helpers/resource-name-prefix | TF/helpers/resource-name-prefix/vALPHA_0.0.2 |
| <a name="module_tags"></a> [tags](#module\_tags) | git@github.com:UKHSA-Internal/devops-terraform-modules.git//terraform-modules/helpers/tags | TF/helpers/tags/vALPHA_0.0.6 |

## Resources

| Name | Type |
|------|------|
| [azurerm_container_app.container_app](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/container_app) | resource |
| [azurerm_container_app_environment.container_env](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/container_app_environment) | resource |
| [azurerm_container_app_environment_dapr_component.dapr](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/container_app_environment_dapr_component) | resource |
| [azurerm_container_app_environment_storage.storage](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/container_app_environment_storage) | resource |
| [azurerm_log_analytics_workspace.law](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/log_analytics_workspace) | resource |
| [azurerm_container_app_environment.container_env](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/container_app_environment) | data source |
| [azurerm_resource_group.rg](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/resource_group) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_container_app_environment"></a> [container\_app\_environment](#input\_container\_app\_environment) | (Optional) Reference to existing container apps environment to use. | <pre>object({<br>    name                = string<br>    resource_group_name = string<br>  })</pre> | `null` | no |
| <a name="input_container_app_environment_infrastructure_subnet_id"></a> [container\_app\_environment\_infrastructure\_subnet\_id](#input\_container\_app\_environment\_infrastructure\_subnet\_id) | (Optional) The existing subnet to use for the container apps control plane. Changing this forces a new resource to be created. | `string` | `null` | no |
| <a name="input_container_app_environment_internal_load_balancer_enabled"></a> [container\_app\_environment\_internal\_load\_balancer\_enabled](#input\_container\_app\_environment\_internal\_load\_balancer\_enabled) | (Optional) Should the Container Environment operate in Internal Load Balancing Mode? Defaults to 'false'. Changing this forces a new resource to be created. | `bool` | `null` | no |
| <a name="input_container_app_environment_tags"></a> [container\_app\_environment\_tags](#input\_container\_app\_environment\_tags) | (Optional) A map of the tags to use on the resources that are deployed with this module. | `map(string)` | `{}` | no |
| <a name="input_container_app_secrets"></a> [container\_app\_secrets](#input\_container\_app\_secrets) | (Optional) The secrets of the container apps. The key of the map should be aligned with the corresponding container app. | <pre>map(list(object({<br>    name  = string<br>    value = string<br>  })))</pre> | `{}` | no |
| <a name="input_container_apps"></a> [container\_apps](#input\_container\_apps) | (Required) The container apps to deploy. | <pre>map(object({<br>    name                  = string<br>    tags                  = optional(map(string))<br>    revision_mode         = string<br>    workload_profile_name = optional(string)<br><br>    template = object({<br>      init_containers = optional(set(object({<br>        args    = optional(list(string))<br>        command = optional(list(string))<br>        cpu     = optional(number)<br>        image   = string<br>        name    = string<br>        memory  = optional(string)<br>        env = optional(list(object({<br>          name        = string<br>          secret_name = optional(string)<br>          value       = optional(string)<br>        })))<br>        volume_mounts = optional(list(object({<br>          name = string<br>          path = string<br>        })))<br>      })), [])<br>      containers = set(object({<br>        name    = string<br>        image   = string<br>        args    = optional(list(string))<br>        command = optional(list(string))<br>        cpu     = string<br>        memory  = string<br>        env = optional(set(object({<br>          name        = string<br>          secret_name = optional(string)<br>          value       = optional(string)<br>        })))<br>        liveness_probe = optional(object({<br>          failure_count_threshold = optional(number)<br>          header = optional(object({<br>            name  = string<br>            value = string<br>          }))<br>          host             = optional(string)<br>          initial_delay    = optional(number, 1)<br>          interval_seconds = optional(number, 10)<br>          path             = optional(string)<br>          port             = number<br>          timeout          = optional(number, 1)<br>          transport        = string<br>        }))<br>        readiness_probe = optional(object({<br>          failure_count_threshold = optional(number)<br>          header = optional(object({<br>            name  = string<br>            value = string<br>          }))<br>          host                    = optional(string)<br>          interval_seconds        = optional(number, 10)<br>          path                    = optional(string)<br>          port                    = number<br>          success_count_threshold = optional(number, 3)<br>          timeout                 = optional(number)<br>          transport               = string<br>        }))<br>        startup_probe = optional(object({<br>          failure_count_threshold = optional(number)<br>          header = optional(object({<br>            name  = string<br>            value = string<br>          }))<br>          host             = optional(string)<br>          interval_seconds = optional(number, 10)<br>          path             = optional(string)<br>          port             = number<br>          timeout          = optional(number)<br>          transport        = string<br>        }))<br>        volume_mounts = optional(list(object({<br>          name = string<br>          path = string<br>        })))<br>      }))<br>      max_replicas    = optional(number)<br>      min_replicas    = optional(number)<br>      revision_suffix = optional(string)<br><br>      volume = optional(set(object({<br>        name         = string<br>        storage_name = optional(string)<br>        storage_type = optional(string)<br>      })))<br>    })<br><br>    ingress = optional(object({<br>      allow_insecure_connections = optional(bool, false)<br>      external_enabled           = optional(bool, false)<br>      ip_security_restrictions = optional(list(object({<br>        action           = string<br>        ip_address_range = string<br>        name             = string<br>        description      = optional(string)<br>      })), [])<br>      target_port = number<br>      transport   = optional(string)<br>      traffic_weight = object({<br>        label           = optional(string)<br>        latest_revision = optional(string)<br>        revision_suffix = optional(string)<br>        percentage      = number<br>      })<br>    }))<br><br>    identity = optional(object({<br>      type         = string<br>      identity_ids = optional(list(string))<br>    }))<br><br>    dapr = optional(object({<br>      app_id       = string<br>      app_port     = number<br>      app_protocol = optional(string)<br>    }))<br><br>    registry = optional(list(object({<br>      server               = string<br>      username             = optional(string)<br>      password_secret_name = optional(string)<br>      identity             = optional(string)<br>    })))<br>  }))</pre> | n/a | yes |
| <a name="input_dapr_component"></a> [dapr\_component](#input\_dapr\_component) | (Optional) The Dapr component to deploy. | <pre>map(object({<br>    name           = string<br>    component_type = string<br>    version        = string<br>    ignore_errors  = optional(bool, false)<br>    init_timeout   = optional(string, "5s")<br>    scopes         = optional(list(string))<br>    metadata = optional(set(object({<br>      name        = string<br>      secret_name = optional(string)<br>      value       = string<br>    })))<br>  }))</pre> | `{}` | no |
| <a name="input_dapr_component_secrets"></a> [dapr\_component\_secrets](#input\_dapr\_component\_secrets) | (Optional) The secrets of the Dapr components. The key of the map should be aligned with the corresponding Dapr component. | <pre>map(list(object({<br>    name  = string<br>    value = string<br>  })))</pre> | `{}` | no |
| <a name="input_environment_storage"></a> [environment\_storage](#input\_environment\_storage) | (Optional) Manages a Container App Environment Storage, writing files to this file share to make data accessible by other systems. | <pre>map(object({<br>    name         = string<br>    account_name = string<br>    share_name   = string<br>    access_mode  = string<br>  }))</pre> | `{}` | no |
| <a name="input_environment_storage_access_key"></a> [environment\_storage\_access\_key](#input\_environment\_storage\_access\_key) | (Optional) The Storage Account Access Key. The key of the map should be aligned with the corresponding environment storage. | `map(string)` | `null` | no |
| <a name="input_log_analytics_workspace"></a> [log\_analytics\_workspace](#input\_log\_analytics\_workspace) | (Optional) A Log Analytics Workspace already exists. | <pre>object({<br>    id = string<br>  })</pre> | `null` | no |
| <a name="input_log_analytics_workspace_allow_resource_only_permissions"></a> [log\_analytics\_workspace\_allow\_resource\_only\_permissions](#input\_log\_analytics\_workspace\_allow\_resource\_only\_permissions) | (Optional) Specifies if the log Analytics Workspace allow users accessing to data associated with resources they have permission to view, without permission to workspace. Defaults to 'true'. | `bool` | `true` | no |
| <a name="input_log_analytics_workspace_cmk_for_query_forced"></a> [log\_analytics\_workspace\_cmk\_for\_query\_forced](#input\_log\_analytics\_workspace\_cmk\_for\_query\_forced) | (Optional) Is Customer Managed Storage mandatory for query management? Defaults to 'false'. | `bool` | `false` | no |
| <a name="input_log_analytics_workspace_daily_quota_gb"></a> [log\_analytics\_workspace\_daily\_quota\_gb](#input\_log\_analytics\_workspace\_daily\_quota\_gb) | (Optional) The workspace daily quota for ingestion in GB. Defaults to '-1' which means unlimited. | `number` | `-1` | no |
| <a name="input_log_analytics_workspace_internet_ingestion_enabled"></a> [log\_analytics\_workspace\_internet\_ingestion\_enabled](#input\_log\_analytics\_workspace\_internet\_ingestion\_enabled) | (Optional) Should the Log Analytics Workspace support ingestion over the Public Internet? Defaults to 'true'. | `bool` | `true` | no |
| <a name="input_log_analytics_workspace_internet_query_enabled"></a> [log\_analytics\_workspace\_internet\_query\_enabled](#input\_log\_analytics\_workspace\_internet\_query\_enabled) | (Optional) Should the Log Analytics Workspace support query over the Public Internet? Defaults to 'true'. | `bool` | `true` | no |
| <a name="input_log_analytics_workspace_local_authentication_disabled"></a> [log\_analytics\_workspace\_local\_authentication\_disabled](#input\_log\_analytics\_workspace\_local\_authentication\_disabled) | (Optional) Specifies if the log analytics workspace should enforce authentication using Azure Active Directory. Defaults to 'false'. | `bool` | `false` | no |
| <a name="input_log_analytics_workspace_name"></a> [log\_analytics\_workspace\_name](#input\_log\_analytics\_workspace\_name) | (Optional) Specifies the name of the Log Analytics Workspace. Must set this variable if 'var.log\_analytics\_workspace' is 'null'. Changing this forces a new resource to be created. | `string` | `null` | no |
| <a name="input_log_analytics_workspace_reservation_capacity_in_gb_per_day"></a> [log\_analytics\_workspace\_reservation\_capacity\_in\_gb\_per\_day](#input\_log\_analytics\_workspace\_reservation\_capacity\_in\_gb\_per\_day) | (Optional) The capacity reservation level in GB for this workspace. Must be in increments of 100 between 100 and 5000. 'reservation\_capacity\_in\_gb\_per\_day' can only be used when the 'sku' is set to 'CapacityReservation'. | `number` | `null` | no |
| <a name="input_log_analytics_workspace_retention_in_days"></a> [log\_analytics\_workspace\_retention\_in\_days](#input\_log\_analytics\_workspace\_retention\_in\_days) | (Optional) The workspace data retention in days. Possible values are either 7 (Free Tier only) or range between 30 and 730. | `number` | `null` | no |
| <a name="input_log_analytics_workspace_sku"></a> [log\_analytics\_workspace\_sku](#input\_log\_analytics\_workspace\_sku) | (Optional) Specifies the SKU of the Log Analytics Workspace. Possible values are 'Free', 'PerNode', 'Premium', 'Standard', 'Standalone', 'Unlimited', 'CapacityReservation', and 'PerGB2018'(new SKU as of '2018-04-03'). Defaults to 'PerGB2018'. | `string` | `"PerGB2018"` | no |
| <a name="input_log_analytics_workspace_tags"></a> [log\_analytics\_workspace\_tags](#input\_log\_analytics\_workspace\_tags) | (Optional) A mapping of tags to assign to the resource. | `map(string)` | `null` | no |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | (Required) The name of the resource group in which the resources will be created. | `string` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | (Required) Tags to be assigned to the resources, must include project, client, owner and environment keys | <pre>object({<br>    project         = string<br>    client          = string<br>    owner           = string<br>    environment     = string<br>    additional_tags = optional(map(string))<br>  })</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_container_app_environment_id"></a> [container\_app\_environment\_id](#output\_container\_app\_environment\_id) | The ID of the Container App Environment within which this Container App should exist. |
| <a name="output_container_app_fqdn"></a> [container\_app\_fqdn](#output\_container\_app\_fqdn) | The FQDN of the Container App's ingress. |
| <a name="output_container_app_identities"></a> [container\_app\_identities](#output\_container\_app\_identities) | The identities of the Container App, key is Container App's name. |
| <a name="output_container_app_ips"></a> [container\_app\_ips](#output\_container\_app\_ips) | The IPs of the Latest Revision of the Container App. |
<!-- END_TF_DOCS -->